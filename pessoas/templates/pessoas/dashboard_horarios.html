{% extends 'pessoas/dashboard_base.html' %}
{% load static %}

{% block title %}Dashboard - Horários{% endblock %}

{% block page_icon %}<i class="bi bi-clock-history"></i>{% endblock %}
{% block page_title %}Horários de Trabalho{% endblock %}

{% block extra_css %}
<style>
    .horarios-container {
        display: grid;
        gap: 25px;
    }
    
    .profissional-horarios {
        background: white;
        border-radius: 16px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        overflow: hidden;
    }
    
    .profissional-horarios-header {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 20px 25px;
        background: linear-gradient(135deg, #1B325F 0%, #2c4a7a 100%);
        color: white;
    }
    
    .profissional-avatar {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid rgba(255,255,255,0.3);
    }
    
    .profissional-avatar-placeholder {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: rgba(255,255,255,0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        font-weight: 600;
        border: 3px solid rgba(255,255,255,0.3);
    }
    
    .profissional-horarios-info h3 {
        margin: 0 0 5px 0;
        font-size: 1.1rem;
    }
    
    .profissional-horarios-info span {
        opacity: 0.8;
        font-size: 0.9rem;
    }
    
    .horarios-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 1px;
        background: #f0f4f8;
        padding: 20px;
    }
    
    .dia-card {
        background: white;
        padding: 15px;
        text-align: center;
        border-radius: 10px;
        min-height: 120px;
    }
    
    .dia-card.ativo {
        background: #E9F2F9;
        border: 2px solid #4C98D0;
    }
    
    .dia-nome {
        font-weight: 600;
        color: #1B325F;
        font-size: 0.85rem;
        margin-bottom: 10px;
    }
    
    .horario-item {
        background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
        color: white;
        padding: 5px 10px;
        border-radius: 15px;
        font-size: 0.75rem;
        margin: 3px 0;
        display: inline-block;
    }
    
    .sem-horario {
        color: #8c9ba8;
        font-size: 0.8rem;
        font-style: italic;
    }
    
    .btn-config {
        margin-left: auto;
        padding: 10px 20px;
        background: rgba(255,255,255,0.2);
        color: white;
        border: none;
        border-radius: 8px;
        font-weight: 500;
        cursor: pointer;
        text-decoration: none;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .btn-config:hover {
        background: rgba(255,255,255,0.3);
        color: white;
    }
    
    .empty-horarios {
        text-align: center;
        padding: 60px;
        color: #8c9ba8;
    }
    
    .empty-horarios i {
        font-size: 4rem;
        color: #d0dae4;
        margin-bottom: 20px;
    }
    
    @media (max-width: 900px) {
        .horarios-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }
    
    @media (max-width: 600px) {
        .horarios-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="horarios-container">
    {% for prof in profissionais %}
    <div class="profissional-horarios">
        <div class="profissional-horarios-header">
            {% if prof.foto %}
                <img src="{{ prof.foto.url }}" alt="{{ prof.nome }}" class="profissional-avatar">
            {% else %}
                <div class="profissional-avatar-placeholder">
                    {{ prof.nome|slice:":1"|upper }}
                </div>
            {% endif %}
            <div class="profissional-horarios-info">
                <h3>{{ prof.nome }}</h3>
                <span>{{ prof.especialidade.nome|default:"Sem especialidade" }}</span>
            </div>
            <a href="{% url 'configurar_horarios' prof.id %}" class="btn-config">
                <i class="bi bi-gear"></i>
                Configurar
            </a>
        </div>
        <div class="horarios-grid">
            {% with dias="Segunda,Terça,Quarta,Quinta,Sexta,Sábado,Domingo" %}
            {% for dia in dias|make_list %}
            {% endfor %}
            {% endwith %}
            
            <div class="dia-card {% if prof.horarios_por_dia.0 %}ativo{% endif %}">
                <div class="dia-nome">Segunda</div>
                {% for h in prof.horarios_por_dia.0 %}
                    <span class="horario-item">{{ h.hora_inicio|time:"H:i" }} - {{ h.hora_fim|time:"H:i" }}</span>
                {% empty %}
                    <span class="sem-horario">Folga</span>
                {% endfor %}
            </div>
            <div class="dia-card {% if prof.horarios_por_dia.1 %}ativo{% endif %}">
                <div class="dia-nome">Terça</div>
                {% for h in prof.horarios_por_dia.1 %}
                    <span class="horario-item">{{ h.hora_inicio|time:"H:i" }} - {{ h.hora_fim|time:"H:i" }}</span>
                {% empty %}
                    <span class="sem-horario">Folga</span>
                {% endfor %}
            </div>
            <div class="dia-card {% if prof.horarios_por_dia.2 %}ativo{% endif %}">
                <div class="dia-nome">Quarta</div>
                {% for h in prof.horarios_por_dia.2 %}
                    <span class="horario-item">{{ h.hora_inicio|time:"H:i" }} - {{ h.hora_fim|time:"H:i" }}</span>
                {% empty %}
                    <span class="sem-horario">Folga</span>
                {% endfor %}
            </div>
            <div class="dia-card {% if prof.horarios_por_dia.3 %}ativo{% endif %}">
                <div class="dia-nome">Quinta</div>
                {% for h in prof.horarios_por_dia.3 %}
                    <span class="horario-item">{{ h.hora_inicio|time:"H:i" }} - {{ h.hora_fim|time:"H:i" }}</span>
                {% empty %}
                    <span class="sem-horario">Folga</span>
                {% endfor %}
            </div>
            <div class="dia-card {% if prof.horarios_por_dia.4 %}ativo{% endif %}">
                <div class="dia-nome">Sexta</div>
                {% for h in prof.horarios_por_dia.4 %}
                    <span class="horario-item">{{ h.hora_inicio|time:"H:i" }} - {{ h.hora_fim|time:"H:i" }}</span>
                {% empty %}
                    <span class="sem-horario">Folga</span>
                {% endfor %}
            </div>
            <div class="dia-card {% if prof.horarios_por_dia.5 %}ativo{% endif %}">
                <div class="dia-nome">Sábado</div>
                {% for h in prof.horarios_por_dia.5 %}
                    <span class="horario-item">{{ h.hora_inicio|time:"H:i" }} - {{ h.hora_fim|time:"H:i" }}</span>
                {% empty %}
                    <span class="sem-horario">Folga</span>
                {% endfor %}
            </div>
            <div class="dia-card {% if prof.horarios_por_dia.6 %}ativo{% endif %}">
                <div class="dia-nome">Domingo</div>
                {% for h in prof.horarios_por_dia.6 %}
                    <span class="horario-item">{{ h.hora_inicio|time:"H:i" }} - {{ h.hora_fim|time:"H:i" }}</span>
                {% empty %}
                    <span class="sem-horario">Folga</span>
                {% endfor %}
            </div>
        </div>
    </div>
    {% empty %}
    <div class="data-table-container">
        <div class="empty-horarios">
            <i class="bi bi-calendar-x"></i>
            <h4>Nenhum profissional cadastrado</h4>
            <p>Cadastre profissionais primeiro para configurar seus horários</p>
            <a href="{% url 'adicionar_profissional' %}" class="btn-add-profissional" style="display: inline-flex; align-items: center; gap: 8px; padding: 12px 24px; background: linear-gradient(135deg, #4C98D0 0%, #3a8bc9 100%); color: white; border-radius: 10px; text-decoration: none; font-weight: 600;">
                <i class="bi bi-plus-circle"></i>
                Adicionar Profissional
            </a>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}
